<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DiaryTaskManagerApp.Features.Folders.Views.FoldersPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:DiaryTaskManagerApp.Features.Folders.ViewModels"
    x:DataType="vm:FoldersPageViewModel"
    BackgroundColor="{StaticResource AppBg}"
    Title="Folders">

    <Grid RowDefinitions="Auto,Auto,*" Padding="16,12" RowSpacing="14">
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
            <Border WidthRequest="48" HeightRequest="48" BackgroundColor="{StaticResource Surface}" StrokeThickness="0" VerticalOptions="Center">
                <Border.StrokeShape><RoundRectangle CornerRadius="16" /></Border.StrokeShape>
                <Border.GestureRecognizers><TapGestureRecognizer Tapped="OnMenuTapped" /></Border.GestureRecognizers>
                <Image Source="menu_icon.svg" WidthRequest="24" HeightRequest="24" HorizontalOptions="Center" VerticalOptions="Center" />
            </Border>
            <Label Grid.Column="1" Text="Folders" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource White}" VerticalOptions="Center" />
        </Grid>

        <Border Grid.Row="1" BackgroundColor="{StaticResource Surface}" StrokeThickness="0">
            <Border.StrokeShape><RoundRectangle CornerRadius="20" /></Border.StrokeShape>
            <Grid Padding="16,14">
                <Picker Title="Sort" ItemsSource="{Binding SortOptions}" SelectedIndex="{Binding SelectedSortIndex}"
                        FontSize="15" TextColor="{StaticResource White}" MinimumHeightRequest="48" />
            </Grid>
        </Border>

        <ScrollView Grid.Row="2">
            <VerticalStackLayout Padding="0,0,0,12" Spacing="12">
                <Border BackgroundColor="{StaticResource Surface}" StrokeThickness="0" Padding="12">
                    <Border.StrokeShape><RoundRectangle CornerRadius="16" /></Border.StrokeShape>
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Entry Grid.Column="0" Placeholder="Folder name..." Text="{Binding NewFolderName}"
                               PlaceholderColor="{StaticResource TextSecondary}" TextColor="{StaticResource White}" FontSize="16"
                               ReturnCommand="{Binding CreateFolderCommand}" ReturnType="Done" />
                        <Border Grid.Column="1" BackgroundColor="{StaticResource Accent}" Padding="12,10" StrokeThickness="0" VerticalOptions="Center">
                            <Border.StrokeShape><RoundRectangle CornerRadius="12" /></Border.StrokeShape>
                            <Border.GestureRecognizers><TapGestureRecognizer Command="{Binding CreateFolderCommand}" /></Border.GestureRecognizers>
                            <Label Text="Create" FontSize="14" TextColor="Black" HorizontalOptions="Center" />
                        </Border>
                    </Grid>
                </Border>

                <CollectionView ItemsSource="{Binding Folders}" SelectionMode="None">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="12" Padding="24">
                            <Label Text="ðŸ“" FontSize="64" HorizontalOptions="Center" Opacity="0.3" />
                            <Label Text="No folders" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center" />
                            <Label Text="Create a folder above" FontSize="14" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="vm:FolderItemViewModel">
                            <Border BackgroundColor="{StaticResource Surface}" StrokeThickness="0" Padding="16" Margin="0,0,0,12">
                                <Border.StrokeShape><RoundRectangle CornerRadius="16" /></Border.StrokeShape>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnFolderTapped" />
                                </Border.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                    <Border WidthRequest="56" HeightRequest="56" BackgroundColor="{StaticResource Surface2}" VerticalOptions="Center">
                                        <Border.StrokeShape><RoundRectangle CornerRadius="16" /></Border.StrokeShape>
                                        <Label Text="ðŸ“" FontSize="30" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>
                                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                        <Label Text="{Binding Folder.Name}" FontSize="17" FontAttributes="Bold" TextColor="{StaticResource White}" />
                                        <Label Text="{Binding TaskCount, StringFormat='{0} tasks'}" FontSize="13" TextColor="{StaticResource TextSecondary}" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="2" Text="â†’" FontSize="24" TextColor="{StaticResource TextSecondary}" VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
